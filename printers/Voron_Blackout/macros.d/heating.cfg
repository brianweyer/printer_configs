[gcode_macro HEAT_NO_WAIT]
gcode:
    {% if params.HEATER == 'extruder' %}
      SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Heating, No Wait - Extruder Temp: {params.TEMP | default(170)}C"
      M104 S{params.TEMP | default(160)}  ; set temperature and wait for it to be reached
    {% endif %}

    {% if params.HEATER == 'bed' %}
      SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Heating, No Wait - Bed Temp: {params.TEMP | default(60)}C"
      M140 S{params.TEMP | default(60)}
    {% endif %}

[gcode_macro HEAT_AND_WAIT]
gcode:
    {% if params.HEATER == 'extruder' %}
     
     SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Waiting - Extruder Temp: {params.TEMP | default(170)}C"
      M109 S{params.TEMP}  ; set temperature and wait for it to be reached
    {% endif %}

    {% if params.HEATER == 'bed' %}
      SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Waiting - Bed Temp: {params.TEMP | default(60)}C"
      M190 S{params.TEMP}
    {% endif %}

[gcode_macro PREHEAT_CHAMBER_EXTRUDER]
gcode:
    M104 S{params.temp | default(160)}   ; Turn on extruder enough to start it's fan
    M106 S255   ; Set part cooling fan to maximum      


[gcode_macro PREHEAT_CHAMBER]
gcode:
    HEAT_NO_WAIT HEATER=bed TEMP=110

    {% if 'xyz' not in printer.toolhead.homed_axes %}
      SAFE_HOME_ALL
    {% endif %}

    CENTER_GANTRY

    {% if params.WAIT is defined and params.CHAMBER is defined and params.CHAMBER|int > 15 %}
      SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Waiting - Chamber Temp: {params.CHAMBER | default(0)}C"
      NEVERMORE_START_FOR FILAMENT_TYPE={params.FILAMENT_TYPE} SPEED=1.0
      TEMPERATURE_WAIT SENSOR='temperature_sensor enclosure_temp_sensor' MINIMUM={params.CHAMBER}
      HEAT_AND_WAIT HEATER=bed TEMP={params.BED}
      NEVERMORE_START_FOR FILAMENT_TYPE={params.FILAMENT_TYPE} SPEED=0.0
    {% endif %}

[gcode_macro WAIT_FOR_CHAMBER]
gcode:
    {% if params.CHAMBER | default(0) %}
      PREHEAT_CHAMBER BED={params.BED} CHAMBER={params.CHAMBER} WAIT=1 FILAMENT_TYPE={params.FILAMENT_TYPE}
    {% endif %}