[gcode_macro HEAT_AND_WAIT]
gcode:
    {% if params.HEATER == "extruder" %}
      M117 Waiting - Extruder Temp
      M109 S{params.TEMP}  ; set temperature and wait for it to be reached
    {% endif %}

    {% if params.HEATER == "bed" %}
      M117 Waiting - Bed Temp
      M140 S{params.TEMP}
    {% endif %}

[gcode_macro PREHEAT_CHAMBER]
gcode:
    M140 S{params.BED | default(110)}

    {% if 'xyz' not in printer.toolhead.homed_axes %}
      G28 Y
      G1 Y175
      HOME_ALL
    {% endif %}

    G1 X175 Y175 Z20 F6000

    M104 S170   ; Turn on extruder enough to start it's fan
    M106 S255   ; Set part cooling fan to maximum      

    {% if params.WAIT is defined and params.CHAMBER is defined and params.CHAMBER|int > 15 %}
      M117 Waiting - Chamber Temp: {params.CHAMBER | default(0)}C
      
      NEVERMORE_START_FOR FILAMENT_TYPE={params.FILAMENT_TYPE} SPEED=1.0
      TEMPERATURE_WAIT SENSOR='temperature_sensor enclosure_temp_sensor' MINIMUM={params.CHAMBER}
      NEVERMORE_START_FOR FILAMENT_TYPE={params.FILAMENT_TYPE} SPEED=0.8
    {% endif %}

[gcode_macro WAIT_FOR_CHAMBER]
gcode:
    {% if params.CHAMBER | default(0) %}
      PREHEAT_CHAMBER BED={params.BED} CHAMBER={params.CHAMBER} WAIT=1
    {% endif %}