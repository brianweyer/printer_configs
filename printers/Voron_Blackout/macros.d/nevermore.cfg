[gcode_macro NEVERMORE_UPDATE]
gcode:
  {% if params.SPEED %}
    M117 Starting - Nevermore with fan speed: {params.SPEED * 100}%
    SET_FAN_SPEED FAN=nevermore SPEED={params.SPEED}
  {% else %}
      M117 No fan speed specified, skipping.
  {% endif %}

[gcode_macro NEVERMORE_START]
gcode:
  NEVERMORE_UPDATE SPEED={params.SPEED | default(0.8)}

[gcode_macro NEVERMORE_START_FOR]
gcode:
  {% set speed = params.SPEED | default(0.8) %}
  {% if params.FILAMENT_TYPE in ("ABS", "ASA") %}
    M117 Starting - Nevermore for {params.FILAMENT_TYPE}
    NEVERMORE_START SPEED={speed}
  {% else %}
    M117 Skipping - Nevermore
  {% endif %}

[gcode_macro NEVERMORE_STOP]
gcode:
  NEVERMORE_UPDATE SPEED=0

[delayed_gcode NEVERMORE_STOP_DELAYED]
gcode:
  NEVERMORE_STOP

