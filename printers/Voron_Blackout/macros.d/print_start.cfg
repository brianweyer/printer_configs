[gcode_macro _BEFORE_BEGIN_PRINT]
gcode:
    status_busy
    UPDATE_DELAYED_GCODE ID=NEVERMORE_STOP_DELAYED DURATION=0
    BED_MESH_CLEAR
    SET_GCODE_OFFSET Z=0
    G28
    SET_GCODE_OFFSET Z=0

[gcode_macro _AFTER_BEGIN_PRINT]
gcode:
    SET_DISPLAY_AND_CONSOLE_LOG MESSAGE="Starting - Print"
    status_printing
    UPDATE_DELAYED_GCODE ID=CLEAR_DISPLAY DURATION=10
    G0 F200 E2
    G92 E0

[gcode_macro PRINT_START]
gcode:
    _BEFORE_BEGIN_PRINT

    HEAT_NO_WAIT HEATER=extruder TEMP=170

    M106 S255
    
    WAIT_FOR_CHAMBER BED={params.BED} CHAMBER={params.CHAMBER} FILAMENT_TYPE={params.FILAMENT_TYPE}

    HEAT_AND_WAIT HEATER=bed TEMP={params.BED}

    CLEAN_NOZZLE PURGE_LENGTH=75

    CENTER_GANTRY

    G28

    LEVEL_GANTRY

    CLEAN_NOZZLE_NO_PURGE

    CALIBRATE_Z

    SET_GCODE_OFFSET Z_ADJUST={params.Z_ADJUST|default(0.0)|float} MOVE=1

    CLEAN_NOZZLE_NO_PURGE

    BED_MESH_CALIBRATE

    CLEAN_NOZZLE_NO_PURGE

    HEAT_AND_WAIT HEATER=extruder TEMP={params.EXTRUDER}
    
    LEVEL_GANTRY

    CLEAN_NOZZLE PURGE_LENGTH=75
    
    _AFTER_BEGIN_PRINT